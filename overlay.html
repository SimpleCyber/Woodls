<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: transparent;
      user-select: none;
      -webkit-app-region: drag; /* draggable if needed, but usually static */
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
  </style>
</head>
<body>
  <!-- Pill Container -->
  <div class="bg-black rounded-full px-4 py-2 flex items-center justify-center gap-1 shadow-2xl transition-transform duration-100 h-full w-full" id="pill">
     
     <!-- Waveform Bars -->
     <div id="waveform" class="flex items-center gap-1 h-full">
        <div class="bar w-1 bg-white rounded-full h-2 transition-all duration-75"></div>
        <div class="bar w-1 bg-white rounded-full h-3 transition-all duration-75"></div>
        <div class="bar w-1 bg-white rounded-full h-5 transition-all duration-75"></div>
        <div class="bar w-1 bg-white rounded-full h-3 transition-all duration-75"></div>
        <div class="bar w-1 bg-white rounded-full h-2 transition-all duration-75"></div>
     </div>

     <!-- Spinner (Hidden by default) -->
     <div id="spinner" class="hidden">
        <i class="fa-solid fa-circle-notch text-white/50 text-sm animate-spin"></i>
     </div>

     <!-- AI Status Icon (ðŸ¤–) -->
     <div id="ai-icon" class="hidden ml-1">
        <span class="text-xs">ðŸ¤–</span>
     </div>

  </div>

  <script>
    const { ipcRenderer } = require('electron');
    const bars = document.querySelectorAll('.bar');
    const pill = document.getElementById('pill');
    const waveform = document.getElementById('waveform');
    const spinner = document.getElementById('spinner');

    ipcRenderer.on('mic-volume', (event, volume) => {
      // volume is 0.0 - 1.0
      const v = Math.max(volume, 0.1); 
      
      bars.forEach((bar, i) => {
          const centerFactor = 1 - Math.abs(i - 2) * 0.2; 
          // Max height constrained by container h=40
          const h = 6 + (v * 25 * centerFactor * (0.8 + Math.random() * 0.4));
          bar.style.height = h + 'px';
      });
    });

    // Processing states
    ipcRenderer.on('processing-start', () => {
        waveform.classList.add('hidden');
        spinner.classList.remove('hidden');
    });

    ipcRenderer.on('processing-end', () => {
        spinner.classList.add('hidden');
        waveform.classList.remove('hidden');
    });

    ipcRenderer.on('set-ai-status', (event, enabled) => {
        const aiIcon = document.getElementById('ai-icon');
        if (enabled) {
            aiIcon.classList.remove('hidden');
        } else {
            aiIcon.classList.add('hidden');
        }
    });
  </script>
</body>
</html>
